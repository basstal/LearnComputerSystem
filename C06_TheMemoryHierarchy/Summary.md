# 存储器层次结构 #

## 存储技术 ##

1. **随机访问存储器**（RAM）分为静态的（SRAM）和动态的（SRAM），SRAM常用作CPU高速缓存，DRAM用作主存以及图形系统的帧缓冲区。
    |       | 每位晶体管数  | 相对访问时间  | 持续的？  | 敏感的？  | 相对花费  | 应用  |
    |-------|-------------|-------------|----------|---------|----------|-------|
    |SRAM   |   6         |      1x     |    是    |    否    |1000x     |高速缓存存储器|
    |DRAM   |   1         |     10x     |   否     |    是    |1x        |主存，帧缓冲区|

2. 从用8个64Mbit 的 8M X 8 的DRAM内存模块取一个64位字，内存控制器将A转换成一个超单元地址（i, j），并将它发送到内存模块，然后内存模块再将i和j广播到每个DRAM。作为响应，每个DRAM输出它的（i, j）超单元的8位内容。模块中的电路收集这些输出，并把它们合并成一个64位字，再返回给内存控制器。

3. DRAM和SRAM会在断电后丢失它们的信息（易失的），存储在ROM（只读存储器，有的类型既可以读也可以写，非易失性存储器）设备中的程序通常被称为**固件**，当一个计算机系统通电以后，它会运行存储在ROM中的固件。

4. 数据流通过**总线**共享电子电路在处理器和DRAM主存之间来来回回。CPU和主存之间的数据传送通过称为**总线事务**的一系列步骤来完成，**读事务**从主存传送数据到CPU，**写事务**从CPU传送数据到主存。

5. 对扇区的**访问时间**有三个主要的部分：
    - 寻道时间，传动臂将读写头定位到包含目标扇区的磁道上，移动传动臂所需的时间。
    - 旋转时间，一旦读写头定位到了期望的磁道，驱动器等待目标扇区的第一个位旋转到读写头下。
    - 传送时间，驱动器读或者写该扇区的内容所需的时间。

6. 访问一个磁盘扇区消耗的时间主要是寻道时间和旋转延迟；因为寻道时间和旋转延迟大致相等，将寻道时间乘2是估计磁盘访问时间的简单而合理的方法。

7. I/O总线比系统总线和内存总线慢，但是它可以容纳种类繁多的第三方I/O设备。

8. CPU使用一种称为**内存映射I/O**的技术来向I/O设备发射命令，在这样的系统中，地址空间中有一块地址是为与I/O设备通信保留的。每个这样的地址称为一个I/O**端口**。

9. 直接内存访问（DMA），设备可以自己执行读或者写总线事务而不需要CPU干涉的过程。这种数据传送称为**DMA传送**。

## 局部性 ##

1. 局部性通常有两种不同的形式：时间局部性和空间局部性。在一个具有良好时间局部性的程序中，被引用过一次的内存位置很可能在不远的将来再被多次引用。在一个具有良好空间局部性的程序中，如果一个内存位置被引用了一次，那么程序很可能在不远的将来引用附近的一个内存位置。

2. 我们称步长为1的引用模式为顺序引用模式。一个连续向量中，每隔k个元素进行访问，就称为步长为k的引用模式。一般而言，随着步长的增加，空间局部性下降。

## 层次结构 ##

1. 数据总是以块大小为传送单元在第k层和第k+1层之间来回复制的。不同层次对之间可以由不同的块大小。

2. 缓存不命中的种类：
    - 对空的缓存不命中称为**强制性不命中**或**冷不命中**。
    - 由于限制性的放置策略（例如将第k+1层的多个块映射到第k层的一个块上）引起的不命中，称为冲突不命中。
    - 程序访问缓存块的某个相对稳定不变的集合，称为这个阶段的工作集。当工作集的大小超过缓存的大小时，缓存会经历容量不命中。

## 高速缓存存储器 ##

1. 每组只有一行（E=1）的高速缓存称为**直接映射**高速缓存。

2. 高速缓存确定一个请求是否命中，并抽取出被请求字的过程分为三步：
    - 组选择，直接用地址的组索引位对应高速缓存中的组号。
    - 行匹配，检查对应行的有效位是否被设置，并用地址的标记位对应高速缓存中的标记位，以此来确定是否命中缓存。
    - 字抽取，使用地址的块偏移位来定位高速缓存中的命中数据起始字节，抽取对应大小的字节。

3. **组相联高速缓存**匹配的基本思想是高速缓存组中任何一行都可以包含映射到这个组的内存块。必须搜索组中的每一行来确定是否命中。先进行组选择，然后匹配组中的每一行标记和有效位，最后进行字节偏移和数据抽取。

4. **全相联高速缓存**只有一个包含所有行的组，它的地址结构中没有组索引位，匹配思想与组相联高速缓存类似。

5. 已经写命中后更新低一层的缓存策略：
    - 直写，在更新高速缓存块的同时将内容写到低一层的缓存上。
    - 回写，当替换算法要驱逐这个更新过的块时，才将内容写到低一层的缓存上。

6. 处理写不命中的情况：
    - 写分配，将块加载到高速缓存中再更新这个高速缓存。
    - 非写分配，直接写入低一层的缓存块。

7. 衡量高速缓存的性能指标：不命中率（不命中数量/引用数量），命中率（1 - 不命中率），命中时间，不命中惩罚。

8. CO（高速缓存块偏移）对应块的字节个数、CI（高速缓存组索引）对应组数、CT（高速缓存标记）剩下的标记用作匹配。

## 编写高速缓存友好的代码 ##

1. 原则：
    - 让最常见的代码运行得更快。
    - 尽量减小每个循环内部的缓存不命中数量。

## 综合：高速缓存对程序性能的影响 ##

## 家庭作业未完成 ##

- 45、46
